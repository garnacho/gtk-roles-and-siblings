2008-10-08  Matthias Clasen  <mclasen@redhat.com>

	* gtk/gtkfilechooserdefault.c (update_current_folder_get_info_cb):
	Don't forget to reset reload_state when current_folder is already
	correct.

2008-10-08  Christian Dywan  <christian@imendio.com>

	Bug 555270 – Allow unsetting a MessageDialog's image

	* gtk/gtkmessagedialog.c (gtk_message_dialog_set_property),
        Remove a superfluous cast to GtkWidget*
	(gtk_message_dialog_set_image): Accept NULL for the image
	and unset the image in that case.

2008-10-08  Christian Dywan  <christian@imendio.com>

	Bug 436533 – Allow more space efficient scroll arrows placement

	* gtk/gtkenums.h: Add GtkArrowPlacement
	* gtk/gtkmenu.c (gtk_menu_class_init), (get_arrows_border),
	(get_arrows_visible_area), (get_double_arrows),
	(get_arrows_sensitive_area): Implement GtkMenu::arrow-placement
        to allow scrolling arrows to be placed at the start, end or both
        Patch by Tommi Komulainen and myself

2008-10-08  Christian Dywan  <christian@imendio.com>

	Bug 555387 – Changing the sensitivity of a statusbar
	mistakenly requires a display

	* gtk/gtkstatusbar.c (set_grip_cursor): Only change the cursor
        of the resize grip if there is a grip window.

2008-10-06  Matthias Clasen  <mclasen@redhat.com>

	* gtk/gtktooltip.c (gtk_tooltip_show_tooltip): Avoid unitialized
	memory warnings from valgrind.

2008-10-07 11:03:30  Tim Janik  <timj@imendio.com>

	* gtk/gtkbox.h: keep GtkBox as an abstract type and keep _gtk_box_new()
	as private function until we settle on the exact semantics.
	renamed _gtk_box_set_old_defaults() as suggested by Mitch.

2008-10-07  Michael Natterer  <mitch@imendio.com>

	* gtk/gtkbox.c: reindent static prototypes.

2008-10-07  Michael Natterer  <mitch@imendio.com>

	Bug 553573 – Add orientation API to GtkBox

	* gtk/gtkbox.[hh]: implement the GtkOrientable interface and
	swallow all code from GtkHBox and GtkVBox. Add gtk_box_new()
	which takes a GtkOrientation argument. Also move the newly
	added "spacing_set" boolean from struct GtkBox to the new
	private struct.

	* gtk/gtkhbox.[ch]
	* gtk/gtkvbox.[ch]: remove all code except the constructor and
	call gtk_orientable_set_orientation() in init().

	* gtk/gtk.symbols: add gtk_box_new().

2008-10-06  Björn Lindqvist  <bjourne@gmail.com>

	Bug 539464 – gtk_cell_view_get_model is missing in GtkCellView

	* gtk/gtkcellview.c (gtk_cell_view_get_model): Add
	gtk_cell_view_get_model.

2008-10-06  Matthias Clasen  <mclasen@redhat.com>

	* gtk/gtkprintunixdialog.c (create_main_page): Show the tooltip
	on the range entry itself, too.

2008-10-04  Tor Lillqvist  <tml@novell.com>

	Bug 132501 - Make utility window translate to tool window in win32

	Implement the utility window type hint. Such windows are kept on
	top of other windows of the same process. Makes GIMP's toolbox and
	dock windows behave more like in GNOME under metacity. Apply the
	same logic also to windows marked with the dialog window type
	hint, and windows that are transient for some other window. I'll
	call such windows "transient-type" below.

	* gdk/win32/gdkevents-win32.c (doesnt_want_key): Drop unused
	variables.

	(ensure_stacking_on_unminimize)
	(ensure_stacking_on_window_pos_changing)
	(ensure_stacking_on_activate_app): New functions to implement the
	desired stacking order. Make sure that a window that is not
	transient-type stays below any transient-type windows of the
	application. When activating a non-transient-type window make sure
	it rises as high as possible while still staying below the lowest
	transient-type window.

	(gdk_event_translate): Call above functions on
	WM_WINDOWPOSCHANGING, WM_ACTIVATEAPP and on WM_SIZE when
	unminimizing. Improve debugging printout.

	* gdk/win32/gdkwindow-win32.c (get_effective_window_decorations):
	Handle utility windows like toolbar windows.

	(gdk_window_new_internal) (update_style_bits): Give utility
	windows the WS_EX_TOOLWINDOW extended style.

	(gdk_window_set_title): If debugging "misc" or "events", make the
	handle of top-level windows show up in their title bars. Very
	useful when looking at debugging output.

	(gdk_window_set_transient_for) (gdk_window_set_keep_above)
	(gdk_window_set_keep_below) (gdk_window_set_modal_hint)
	(gdk_window_set_skip_taskbar_hint)
	(gdk_window_set_skip_pager_hint): Add and improve debugging
	printout.

	(gdk_window_set_type_hint): Print hint symbolically in GDK_NOTE().

2008-10-04  Tor Lillqvist  <tml@novell.com>

	* gdk/win32/gdkmain-win32.c (_gdk_win32_window_exstyle_to_string)
	(_gdk_win32_window_pos_bits_to_string): New debugging printout
	functions. Decode the WS_EX_* and SWP_* bits.

	* gdk/win32/gdkprivate-win32.h: Declare them. Define
	GDK_DEBUG_MISC_OR_EVENTS for use in GDK_NOTE() to match either
	"misc" or "events".

2008-10-03  Matthias Clasen <mclasen@redhat.com>

	* gtk/gtkmodules.c (_gtk_modules_settings_changed): Add some
	debug output.

2008-10-02  Matthias Clasen <mclasen@redhat.com>

	Bug 96431 – Can't cut and paste / DND within invisible entry

	* gtk/gtkentry.c: Disable cut, copy and drag out of an invisible
	entry. Proposed by Owen Taylor

2008-10-02  Matthias Clasen <mclasen@redhat.com>

	Bug 530575 – GtkEntry with invisible chars has a confused cursor in
	overwrite mode

	* gtk/gtkentry.c (gtk_entry_draw_cursor): Use the visible text
	in the layout when positioning the cursor, not the actual text
	content of the entry. This makes a different when using overwrite
	mode in an invisible entry. 
	Problem noticed by Jonathan Blandford

	* gtk/gtktextutil.c: Fix a typo in a comment

2008-10-02  Christian Persch

        Bug 554704 – gtkfilesystemmodel does too much work

        * gtk/gtkfilesystemmodel.c: Replace g_slist_length()<1 check with a
        simple NULL check.

2008-10-02  Christian Persch

        Bug 554701 – filechooser spams console with useless warnings

        * gtk/gtkfilesystem.c.c: Don't warn if the async call was simply
        cancelled.

2008-10-02  Christian Persch

        Bug 554698 – mem leak in filechooser

        * gtk/gtkfilechooserdefault.c: Plug a mem leak.

2008-10-02  Christian Persch

        Bug 554696 – invalid free function used

        * gtk/gtkfilesystemmodel.c: Use the right free func.

2008-10-02  Christian Persch

        Bug 554691 – mem leak in filechooser

        * gtk/gtkfilesystemmodel.c: Plug a mem leak.

2008-10-02  Christian Persch

        Bug 554690 – mem leak in filechooser

        * gtk/gtkfilechooserdefault.c: Plug a mem leak.

2008-10-02  Michael Natterer  <mitch@imendio.com>

	Bug 553585 – Add orientation API to GtkRuler

	* gtk/gtkruler.[ch]: implement the GtkOrientable interface and
	swallow all code from GtkHRuler and GtkVRuler. Add gtk_ruler_new()
	which takes a GtkOrientation argument.

	* gtk/gtkhruler.c
	* gtk/gtkvruler.c: remove all code except the constructor and
	call gtk_orientable_set_orientation() in init().

	* gtk/gtk.symbols: add gtk_ruler_new().

2008-10-01  Torsten Schoenfeld  <kaffeetisch@gmx.de>

	* docs/reference/gtk/gtk-sections.txt:
	* gtk/gtk.symbols:
	* gtk/gtkselection.c:
	* gtk/gtkselection.h: Add gtk_selection_data_get_selection to
	retrieve the sealed struct field GtkSelectionData.selection.

2008-10-01  Tor Lillqvist  <tml@novell.com>

	* gtk/gtkscalebutton.c: Don't #define _GNU_SOURCE on Windows as it
	confuses newest mingw headers.

2008-10-01  Tor Lillqvist  <tml@novell.com>

	* gdk/win32/gdkkeys-win32.c (gdk_keymap_get_caps_lock_state):
	Implement trivially on Windows. Not sure if something more complex
	is actually needed, more specifically whether the function needs
	to differentiate between "Caps Lock" and "Shift Lock" semantics?

2008-10-01  Simos Xenitellis  <simos@gnome.org>

	Bug 554506 – combining diacritics broken, became deadkeys

	* gtk/gtkimcontextsimple.c: added check if keysym is greater
	than 0x1000000, in this case it is not a dead key.

2008-09-30  Michael Natterer  <mitch@imendio.com>

	Bug 553582 – Add orientation API to GtkSeparator

	* gtk/gtkseparator.[ch]: implement the GtkOrientable interface and
	swallow all code from GtkHSeparator and GtkVSeparator. Add
	gtk_separator_new() which takes a GtkOrientation argument.

	* gtk/gtkhseparator.c
	* gtk/gtkvseparator.c: remove all code except the constructor and
	call gtk_orientable_set_orientation() in init().

	* gtk/gtk.symbols: add gtk_separator_new().

2008-09-30  Marek Kasik  <mkasik@redhat.com>

	Bug 344522 – support non-local destination files (GtkPrint):

	* gtk/gtkprintunixdialog.c
	* gtk/gtkprinteroptionwidget.c: Process URI instead of filename.
	* modules/printbackends/file/gtkprintbackendfile.c: Add ability
	to save files on non-local filesystems.

2008-09-30  Michael Natterer  <mitch@imendio.com>

	* gtk/gtk.symbols: forgot the G_GNUC_CONST of
	gtk_orientable_get_type().

2008-09-30  Michael Natterer  <mitch@imendio.com>

	Bug 541009 – Get rid of separate subclasses for horizontal and
	vertical orientation:

	* gtk/Makefile.am
	* gtk/gtk.symbols
	* gtk/gtk.h
	* gtk/gtkorientable.[ch]: add new interface GtkOrientable which
	will be implemented by everything that can switch orientation.

2008-09-30  Christian Dywan  <christian@imendio.com>

	Fix a typo in the tutorial.

	* docs/tutorial/gtk-tut.sgml: It's mnemonic, not 'mnemnonic'.

2008-09-29  Matthias Clasen  <mclasen@redhat.com>

	Bug 553086 – hard to see current immodule

	* gtk/gtkimmulticontext.c (gtk_im_multicontext_append_menuitems):
	Display the actually selected context in the system menuitem.
	Complaint by Akira Tagoh.

2008-09-29  Matthias Clasen  <mclasen@redhat.com>

	Bug 530568 – Entries with visibility=FALSE should warn for caps-lock
	on

	* gtk/gtkentry.c: Add a tooltip-like Caps Lock warning for
	password entries. The warning is also triggered if an input method
	is active. The warning can be turned off using the
	GtkEntry::caps-lock-warning property. 
	Proposed by Owen Taylor

2008-09-29  Matthias Clasen  <mclasen@redhat.com>

	* gtk/gtk.symbols:
	* gtk/gtkimmulticontext.[hc] (gtk_im_multicontext_get_context_id): 
	Add a getter for the the sealed context_id field.

2008-09-29  Matthias Clasen  <mclasen@redhat.com>

	Bug 107000 – Add signals to GdkKeymap for monitoring caps_lock, etc.

	* gdk/gdk.symbols:
	* gdk/gdkkeys.[ch]: Add a new GdkKeymap::state-changed signal, and
	a gdk_keymap_get_caps_lock_state function.

	* gdk/x11/gdkkeys-x11.c: Implement it here. For now, only emit
	state-changed when caps lock lockedness changes. 

	* gdk/x11/gdkdisplay-x11.c: Also select for modifier lock status
	changes in the XkbSelectEventDetails call.

2008-09-29  Kristian Rietveld  <kris@imendio.com>

	Bug 487624 - Tooltips doesn't get updated if ther's no mouse motion
	over widget

	* gtk/gtkwidget.c (gtk_widget_set_property): after updating
	tooltip text or markup, call gtk_widget_trigger_tooltip_query()
	so that existing visible tooltips are updated.

2008-09-29  Matthias Clasen  <mclasen@redhat.com>

	Bug 371908 – Password Entry broken
	Bug 317002 – Disable input method completely in GtkEntry when it's 
	in invisible mode.

	* gtk/gtkentry.c (gtk_entry_backspace): Make backspace behave
	properly when invisible.

	* gtk/gtkentry.c (gtk_entry_create_layout): Show preedit even if
	invisible. 

	* gtk/gtkentry.c (gtk_entry_set_visibility): Don't disable input
	methods when making the entry invisible.
	
2008-09-29  Emmanuele Bassi  <ebassi@linux.intel.com>

	* gdk/x11/gdkinput.c:
	(gdk_device_class_init), (gdk_device_finalize): Correctly chain
	up the finalize implementation.

2008-09-29  Richard Hult  <richard@imendio.com>

	Bug 554141 – uninitialized data use/free in gtkclipboard-quartz.c

	* gtk/gtkclipboard-quartz.c: (gtk_clipboard_wait_for_contents):
	Patch from Jon A. Cruz to initialize the allocated selection data.

2008-09-27  Matthias Clasen  <mclasen@redhat.com>

	Bug 339367 – Incorrect spotlocation

	* modules/input/gtkimcontextxim.c: Correct the spot location
	for on-the-spot style.

2008-09-27  Denis Washington  <denisw@svn.gnome.org>

	* gtk/gtkiconview.c: only draw keyboard focus when keyboard navigation
	is used, like GtkTreeView. (Bug #553575)

2008-09-26  Matthias Clasen  <mclasen@redhat.com>

	Bug 552959 – GtkTrayIcon: _NET_SYSTEM_TRAY_VISUAL and real
	transparency

	* gtk/gtktrayicon-x11.c: Add support for the _NET_SYSTEM_TRAY_VISUAL
	property described in
	http://lists.freedesktop.org/archives/xdg/2008-September/009919.html
	If _NET_SYSTEM_TRAY_VISUAL is a visual with an alpha channel, the 
	parent-relative-background hack is skipped and we draw with a real
	transparent background.

	* gtk/gtkrc.c: Remove the default GtkTrayIcon style, since the
	parent-relative background is now set when realizing the tray
	icon.

	Patch by Owen Taylor

2008-09-26  Matthias Clasen  <mclasen@redhat.com>

	Bug 552956 – Should check composite extension version

	* gdk/x11/gdkdisplay-x11.c: Check that the version of the
	composite extension is at least 0.4.
	Patch by Owen Taylor

2008-09-26  Matthias Clasen  <mclasen@redhat.com>
	
	Bug 553803 – eventually call XCloseDevice on XOpenDevice results

	* gdk/x11/gdkinput.c: Add a finalize function for device objects,
	and call XCloseDevice there. 

	* gdk/x11/gdkinput-x11.c:
	* gdk/x11/gdkdisplay-x11.c: Move freeing of device objects to
	the finalize function.
	Patch by Caolan McNamara
	
2008-09-26  Matthias Clasen  <mclasen@redhat.com>

	Bug 553578 - tabs are not drawn correctly

	* gtk/gtknotebook.c: Track the visibility state of notebook tabs 
	between allocations so that we know to redraw the tab labels if 
	tabs are hidden and shown without changing position. 
	Reported by Marek Kašík, patch by Owen Taylor.

2008-09-26  Matthias Clasen  <mclasen@redhat.com>

	Bug 553133 – GtkFileChooser won't ask to mount a volume
	Bug 553211 – GtkFileChooserButton unsets filter after first use

	* gtk/gtkfilechooserdefault.c (shortcuts_activate_volume): Use
	a GtkMountOperation when mounting, so that we get a password
	dialog when required.  

	* gtk/gtkfilechooserdefault.c (show_and_select_files): Also
	get the content-type, since it is used later on. 
	Pointed out by Davyd Madeley.

2008-09-26  Cody Russell  <bratsche@gnome.org>

	Bug 553917 – Typo in gdkwindow-win32.c

	* gdk/win32/gdkwindow-win32.c: Fixed a typo in
	update_system_menu().  Changed GDK_DECOR_ALL to GDK_FUNC_ALL.

	Reported by Richard Hult

2008-09-25  Marek Kasik  <mkasik@redhat.com>

	Bug 553241 – double freed pointer in lpr_write cause firefox3 crash

	* modules/printbackends/lpr/gtkprintbackendlpr.c:
	The redundant freeing of memory was removed.

	Patch by Chris Wang

2008-09-25  Michael Natterer  <mitch@imendio.com>

	* gtk/gtkfilechooserdefault.c (gtk_file_chooser_default_finalize):
	don't unref the file system backend, the newly added
	unset_file_system_backend() already does this (bug #553135).

2008-09-24  Michael Natterer  <mitch@imendio.com>

	* gtk/gtkeventbox.c: events return gboolean not gint, reindented
	static prototypes.

2008-09-24  Johan Dahlin  <johan@gnome.org>

	Bug 553385 – gtk-builder-convert creates untranslated combobox models

	* gtk/gtk-builder-convert: Set the translatable property on
	col tags for converted combos.

2008-09-24  Tor Lillqvist  <tml@novell.com>

	* gtk-zip.sh.in: Include all of share/man, lib/pkgconfig,
	share/aclocal and share/gtk-doc instead of trying to list
	individual files or subdirectories. We had missed gail.pc, for
	instance.

2008-09-24  Christian Dywan  <christian@imendio.com>

	Bug 538782 – Make GtkMenu's arrow size themable

	* gtk/gtkmenu.c (gtk_menu_class_init), (gtk_menu_paint):
        Implement "arrow-scaling" style property in GtkMenu.

2008-09-24  Christian Dywan  <christian@imendio.com>

	Bug 408244 – add GtkDialog::content-area-spacing

	* gtk/gtkbox.c (gtk_box_init), (gtk_box_set_spacing),
	(_gtk_box_set_spacing_set), (_gtk_box_get_spacing_set):
	* gtk/gtkbox.h:
	* gtk/gtkdialog.c (gtk_dialog_class_init), (update_spacings):
        Implement "content-area-spacing" style property in GtkDialog
        and internal helper _gtk_box_get_spacing_set in GtkBox.
        Patch by Tim Janik, Sven Herzberg and myself.

2008-09-24  Christian Dywan  <christian@imendio.com>

	Bug 541391 – Unfocussable Treeview swallows focus

	* gtk/gtktreeview.c (grab_focus_and_unset_draw_keyfocus),
	(gtk_tree_view_focus): Honor GTK_WIDGET_CAN_FOCUS properly

2008-09-24  Denis Washington  <denisw@svn.gnome.org>

	* gtk/gtkiconview.c: draw focus as a rectangle around the
	complete item, not just the text. (Bug #38254)

2008-09-23  Michael Natterer  <mitch@imendio.com>

	* gtk/gtkobject.c
	* gtk/gtksignal.[ch]: s/GtkType/GType/ and
	s/GtkSignalMarshaller/GSignalCMarshaller/.

2008-09-23  Michael Natterer  <mitch@imendio.com>

	* gdk/x11/gdkevents-x11.c (gdk_event_translate): remove unused
	variable and fix indentation.

2008-09-23  Michael Natterer  <mitch@imendio.com>

	* gtk/gtkclist.h
	* gtk/gtkctree.h
	* gtk/gtklist.h
	* gtk/gtklistitem.h
	* gtk/gtkobject.h
	* gtk/gtkoldeditable.h
	* gtk/gtkpixmap.h
	* gtk/gtkpreview.h
	* gtk/gtktext.h
	* gtk/gtktipsquery.h
	* gtk/gtktree.h
	* gtk/gtktreeitem.h: get rid of GtkType and GTK_CHECK_FOO() also
	in all deprecated headers.

2008-09-22  Matthias Clasen  <mclasen@redhat.com>

	Bug 553135 – eog crash: assertion failed. Gtk error:
	shortcuts_remove_rows: code should not be reached

	* gtk/gtkfilechooserdefault.c: Disconnect from GtkFileSystem 
	signals when we are destroyed, in order to avoid nasty surprises.
	Patch by Claudio Saavedra

2008-09-22  Emmanuele Bassi  <ebassi@linux.intel.com>

	Bug 552789 – Show size column in the search and recently used
	files modes

	* gtk/gtkfilechooserdefault.c: Display the file size column
	when in OPERATION_MODE_SEARCH. This removes a stat() call
	and simplifies the code a little bit by changing the query
	for file informations for each search engine hit.

2008-09-22  Michael Natterer  <mitch@imendio.com>

	* gtk/gtksignal.[ch]
	* gtk/gtkclist.c
	* gtk/gtklist.c
	* gtk/gtkmain.c
	* gtk/gtktext.c
	* gtk/gtktreeitem.c: use G_CALLBACK and GCallback instead of
	GTK_SIGNAL_FUNC and GtkSignalFunc also in deprecated code.

2008-09-22  Frederic Crozat  <fcrozat@mandriva.com>

	* gtk/gtkfilesystem.c: use the correct gi18n header.
	Fixes bug #553000.

2008-09-22  Michael Natterer  <mitch@imendio.com>

	* gtk/gtktoolbar.[ch]: add "Deprecated: 2.4" to all the deprecated
	append(), prepend() and insert() functions and recommend to use
	gtk_toolbar_insert() instead. Use GCallback instead of
	GtkSignalFunc even in deprecated API.

2008-09-20  Matthias Clasen  <mclasen@redhat.com>

	* gtk/gtkfilechooserbutton.c (filter_model_visible_func): Don't
	leak a GFile.

2008-09-19  Owen Taylor  <otaylor@redhat.com>

	Small cleanups to debug messages for GtkPlug/GtkSocket

	* gtk/gtksocket-x11.c: Fix debug message to say "Socket" not "Plug"
	* gtk/gtkplug-x11.c: Remove excess newlines from the ends of debug
	messages.

2008-09-19  Carlos Garnacho  <carlos@imendio.com>

	Bug 83935 – GtkEntry's default invisible char should be U+25CF

	* gtk/gtkentry.c (find_invisible_char) (gtk_entry_init): Find a
	more suitable invisible char than '*' based on the used font.
	(gtk_entry_class_init) (gtk_entry_set_property)
	(gtk_entry_get_property): Add a "invisible-char-set" property.
	(gtk_entry_unset_invisible_char): New function, needed now that the
	default invisible char isn't fixed.
	* gtk/gtkentry.h:
	* gtk/gtk.symbols:
	* docs/reference/gtk/gtk-sections.txt: Add the new function.

2008-09-19  Christian Persch  <chpe@gnome.org>
 
 	Bug 552837 – mem leak in gtkimmulticontext
 
 	* gtk/gtkimmulticontext.c: (gtk_im_multicontext_get_slave): Plug mem
 	leak.
 
2008-09-18  Emmanuele Bassi  <ebassi@linux.intel.com>

	* gtk/gtkfilechooserdefault.c (settings_save): Save the size column
	visibility state with the rest of the FileChooser settings.

2008-09-18  Emmanuele Bassi  <ebassi@linux.intel.com>

	Bug 325095 – show a 'size' column

	* gtk/gtkfilechooserdefault.c:
	* gtk/gtkfilechooserprivate.h: Add a context menu item controlling
	the visibility of the file size column. This works only for the
	browse mode, and the column is not visible by default.

	* gtk/gtkfilechoosersettings.[ch]: Add a ShowSizeColumn key to the
	settings file.

2008-09-18  Dominic Lachowicz  <domlachowicz@gmail.com>

	* modules/engines/ms-windows/*: Revert most of previous patch, as
	it didn't work as expected; Some work toward #531086 - the new
	GtkTooltip widget doesn't theme properly on win32. Now, at least
	the background color seems okay
	
2008-09-18  Dominic Lachowicz  <domlachowicz@gmail.com>

	* modules/engines/ms-windows/*: MS Windows style should use
	pango_win32_font_description_from_logfont; Allows us to rip out a
	lot of potentially buggy code, and also get the font specification
	from the XP theme (#434987)
	
2008-09-18  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: updated version number to 2.15.0 for development.

	* ChangeLog.pre-2-14: rotate ChangeLog

=== Branch for 2.14 ===
